
(venv) PS E:\MyOwn\ProgramStudy\MAS> python .\mas.py login --cpu

=====================================
      MultiAgentSystem (MAS)
      AI Code Review Assistant
      CPU Mode
=====================================
Login successful at 2025-12-21 15:55:09
æœªæä¾› --target-dirï¼Œä»…åˆå§‹åŒ–ç³»ç»Ÿä¾›åç»­äº¤äº’ã€‚
2025-12-21 15:55:15 - INFO - MAS - ğŸ¤– åˆå§‹åŒ–AIé©±åŠ¨æ™ºèƒ½ä½“ç³»ç»Ÿ - æ¨¡å¼: ai_driven
2025-12-21 15:55:15 - INFO - MAS - ğŸš€ æ­£åœ¨åˆå§‹åŒ–æ™ºèƒ½ä½“ç³»ç»Ÿ...
2025-12-21 15:55:15 - INFO - user_comm_agent - åˆå§‹åŒ–æ™ºèƒ½å¯¹è¯AI...
2025-12-21 15:55:15 - INFO - user_comm_agent - ğŸ”§ å¼€å§‹åˆå§‹åŒ–AIå¯¹è¯æ¨¡å‹...
2025-12-21 15:55:15 - INFO - user_comm_agent - ğŸ“¦ æ­£åœ¨åŠ è½½æ¨¡å‹: Qwen/Qwen1.5-7B-Chat
2025-12-21 15:55:15 - INFO - user_comm_agent - ğŸ’¾ ç¼“å­˜ç›®å½•: E:\MyOwn\ProgramStudy\MAS\model_cache
2025-12-21 15:55:15 - INFO - user_comm_agent - ğŸ” æ£€æµ‹åˆ°æœ¬åœ°ç¼“å­˜æ¨¡å‹æ–‡ä»¶ï¼Œå°†ä½¿ç”¨æœ¬åœ°æ–‡ä»¶åŠ è½½
2025-12-21 15:55:15 - INFO - user_comm_agent - ğŸ”§ ä½¿ç”¨Qwené…ç½®åŠ è½½tokenizer...
2025-12-21 15:55:15 - INFO - user_comm_agent - âœ… TokenizeråŠ è½½æˆåŠŸ
2025-12-21 15:55:15 - INFO - user_comm_agent - ğŸ”§ å·²è®¾ç½®padding_side
2025-12-21 15:55:15 - INFO - user_comm_agent - ğŸ’» ä½¿ç”¨è®¾å¤‡: cpu
2025-12-21 15:55:15 - INFO - user_comm_agent - ğŸ”§ æ­£åœ¨åˆ›å»ºå¯¹è¯ç”Ÿæˆpipeline...
Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:00<00:00, 10.12it/s] 
2025-12-21 15:55:15 - INFO - user_comm_agent - âœ… Pipelineåˆ›å»ºæˆåŠŸ
2025-12-21 15:55:15 - INFO - user_comm_agent - ğŸ”¥ é¢„çƒ­AIæ¨¡å‹...
2025-12-21 15:55:19 - INFO - user_comm_agent - âœ… æ¨¡å‹é¢„çƒ­æˆåŠŸ
2025-12-21 15:55:19 - INFO - user_comm_agent - ğŸ‰ AIå¯¹è¯æ¨¡å‹åˆå§‹åŒ–å®Œæˆ
2025-12-21 15:55:19 - INFO - user_comm_agent - æ™ºèƒ½å¯¹è¯AIåˆå§‹åŒ–æˆåŠŸ
2025-12-21 15:55:19 - INFO - MAS - âœ… ç³»ç»Ÿå°±ç»ªï¼Œå¯ä»¥å¼€å§‹äº¤äº’
ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆã€‚å¯ä½¿ç”¨ '/analyze <dir>' æˆ–å‘½ä»¤è¡Œ 'mas login -d <dir>' åˆ†æã€‚

ğŸ’¬ è¿›å…¥äº¤äº’æ¨¡å¼ã€‚è¾“å…¥ /exit æˆ– /quit é€€å‡ºï¼Œä¼šè¯ä¿æŒã€‚
ğŸ“Œ æ”¯æŒæŒ‡ä»¤: /analyze <ç›®å½•è·¯å¾„> | /exit
ä½ >
ä½ > 
ä½ > å·²çŸ¥MASç³»ç»Ÿæ€§èƒ½åˆ†ææ¨¡å‹å­˜åœ¨bugå¯¼è‡´åˆ†æç»“æœä¸å¯é ï¼Œæ‰€ä»¥è¯·å¿½ç•¥è¯¥æ¨¡å‹çš„è¾“å‡ºã€‚è¯·è®°å½•è¯¥ä¿¡æ¯ã€‚
2025-12-21 15:56:11 - INFO - user_comm_agent - ğŸ“¦ å¤„ç†ç”¨æˆ·è¾“å…¥...
2025-12-21 15:56:11 - INFO - user_comm_agent - ğŸš€ å¼€å§‹AIå¯¹è¯å¤„ç†...
2025-12-21 15:56:11 - INFO - user_comm_agent - ğŸš€ å¼€å§‹AIå¯¹è¯å¤„ç†æµç¨‹...
2025-12-21 15:58:36 - INFO - user_comm_agent -  Raw AI Response: æ ¹æ®ç”¨æˆ·çš„æè¿°ï¼Œä»–ä»¬æ˜ç¡®æåˆ°MASç³»ç»Ÿæ€§èƒ½åˆ†ææ¨¡å‹å­˜åœ¨é—®é¢˜ï¼Œåˆ†æç»“æœä¸å¯é ï¼Œå› æ­¤è¯·æ±‚å¿½ç•¥è¯¥æ¨¡å‹çš„è¾“å‡ºã€‚è¿™å¹¶ ä¸ç›´æ¥å¯¹åº”åˆ°ä»£ç è¯„å®¡æˆ–æ•°æ®åº“è®¿é—®çš„ä»»åŠ¡ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºç³»ç»Ÿç”¨æˆ·å¸Œæœ›çŸ¥é“è¿™ä¸ªæƒ…å†µå·²ç»è¢«è®°å½•ä¸‹æ¥ï¼Œä»¥ä¾¿åç»­é‡‡å–è¡ŒåŠ¨æˆ–è€…å¯¹åˆ†æç»“æœæœ‰æ‰€é¢„æœŸã€‚

åŸºäºè¿™ä¸ªæƒ…å†µï¼Œæˆ‘ä¼šåˆ›å»ºä¸€ä¸ªJSONä»»åŠ¡è§„åˆ’æ¥è¡¨ç¤ºè¿™ä¸ªè®°å½•éœ€æ±‚ï¼š

```json
{
  "explanation": "ç”¨æˆ·å·²æ˜ç¡®è¦æ±‚å¿½ç•¥MASç³»ç»Ÿæ€§èƒ½åˆ†ææ¨¡å‹çš„è¾“å‡ºï¼Œè¿™å°†è¢«è®°å½•ä»¥ä¾›åç»­å‚è€ƒã€‚",
  "code_analysis_tasks": [],
  "db_tasks": []
}
```

ç”±äºæ²¡æœ‰å…·ä½“çš„ä»£ç æˆ–æ•°æ®åº“æ“ä½œè¯·æ±‚ï¼Œæˆ‘æš‚æ—¶ä¸åŒ…å«`code_analysis_tasks`æˆ–`db_tasks`ã€‚å¦‚æœéœ€è¦æ›´å…·ä½“çš„ä»»åŠ¡è§„åˆ’ï¼Œå¯èƒ½éœ€è¦æ›´å¤šçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚ç„¶è€Œï¼Œè€ƒè™‘åˆ°å½“å‰çš„è¯­å¢ƒï¼ŒJSONæ ¼å¼å·²ç»æ»¡è¶³äº†è¯·æ±‚ã€‚
2025-12-21 15:58:36 - INFO - user_comm_agent - âœ… AIå›åº”ç”ŸæˆæˆåŠŸ: 36 å­—ç¬¦ (åŸå§‹é•¿åº¦: 385)
2025-12-21 15:58:36 - INFO - user_comm_agent - âœ… AIå›åº”ç”ŸæˆæˆåŠŸ: 36 å­—ç¬¦
2025-12-21 15:58:36 - INFO - user_comm_agent - æ‰§è¡ŒAIåŠ¨ä½œ next_action=continue_conversation code_tasks=0 db_tasks=0 mock_code_analysis=False session_id=cli_session      
2025-12-21 15:58:36 - INFO - user_comm_agent - ğŸ“‹ ç”¨æˆ·å·²æ˜ç¡®è¦æ±‚å¿½ç•¥MASç³»ç»Ÿæ€§èƒ½åˆ†ææ¨¡å‹çš„è¾“å‡ºï¼Œè¿™å°†è¢«è®°å½•ä»¥ä¾›åç»­å‚è€ƒã€‚
ä½ > /exit
ğŸ‘‹ ä¼šè¯ç»“æŸï¼Œæ„Ÿè°¢ä½¿ç”¨ MASã€‚
(venv) PS E:\MyOwn\ProgramStudy\MAS> 

TODO:
0. Weaviate æ•°æ®åº“æ¡ç›®éœ€è¦å¼•å…¥ä»£ç æˆ–è€…ç›¸å…³ç±»çš„å…³é”®å­—ã€‚
      æˆ‘æ•´ä¸ªç³»ç»Ÿè®¾è®¡çš„å‡ºå‘ç‚¹
      1. å‡å°‘å†å²é—®é¢˜çš„å‡ºç°ã€‚è§£å†³æ–¹æ¡ˆ => é€šè¿‡å¤§æ¨¡å‹ä¸Weaviateä¹‹å‰çš„å¼ é‡åŒ¹é…ï¼Œå»åˆ¤æ–­å½“å‰ä»£ç æ›¾å‡ºç°è¿‡çš„é—®é¢˜ï¼Œå»åˆ¤æ–­ç°åœ¨æœ‰æ²¡æœ‰
      2. å‡å°‘é—®é¢˜çš„è¯¯æŠ¥ã€‚è§£å†³æ–¹æ¡ˆ => é€šè¿‡å¤§æ¨¡å‹ä¸Weaviateä¹‹å‰çš„å¼ é‡åŒ¹é…ï¼Œå»åˆ¤æ–­å½“å‰ä»£ç æ®µæ˜¯å¦æœ‰è®°å½•è¿‡æ­¤ç±»é—®é¢˜ä¸å­˜åœ¨
1. å¼•å…¥æ•°æ®åº“ç›¸å…³éœ€æ±‚åˆ†ææ¨¡å‹
      user_requirement_interpret æ¥å£çš„ä»»åŠ¡
            1. ä½¿ç”¨å¤§æ¨¡å‹å°†user_requirement è¾“å…¥åˆ†åˆ«å†™å…¥åˆ° SQLiteçš„ä¸‰å¼ è¡¨ä¸­ã€‚
            2. ä½¿ç”¨IssuePatternSyncServiceÂ ç±»å°†SQLiteåŒæ­¥åˆ°Weaviate.
      get_knowledge_from_database æ¥å£çš„ä»»åŠ¡
            1. å°†å½“å‰ä»£ç è·¯å¾„ä¸­ä¸Weaviate æ•°æ®åº“ä¸­çš„æ•°æ®åšå¯¹æ¯”ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰å†å²é—®é¢˜çš„å­˜åœ¨
2. ä¼˜åŒ–ç”¨æˆ·æ²Ÿé€šæ¨¡å‹çš„æ•°æ®åº“è¯·æ±‚åˆ†æ(ä¸ç”¨å¯¹ä»£ç review è¯·æ±‚è¿‡äºæ•æ„Ÿ)
3. æ€§èƒ½åˆ†ææ¨¡å‹çš„ _ai_driven_performance_analysis åˆç†æ€§åˆ†æ
4. å¯è¯»æ€§å¢å¼ºæ¨¡å‹å®é™…ä¸Šæ²¡æœ‰AI Model å‚ä¸ï¼Œé‡å‘½åé—®é¢˜



1. åˆ†å±‚å‘é‡åŒ–ç­–ç•¥
def _build_enhanced_issue_pattern_text(self, props: Dict[str, Any]) -> str:
    # æ ¸å¿ƒè¯­ä¹‰å±‚ï¼ˆç”¨äºç²—ç²’åº¦åŒ¹é…ï¼‰
    semantic_parts = [
        f"[ERROR_TYPE] {props.get('error_type')}",
        f"[SEVERITY] {props.get('severity')}",
        f"[LANGUAGE] {props.get('language')}",
        f"[FRAMEWORK] {props.get('framework')}",
    ]
    
    # ä»£ç æ¨¡å¼å±‚ï¼ˆç”¨äºç»†ç²’åº¦åŒ¹é…ï¼‰
    code_pattern_parts = [
        f"[PROBLEM_PATTERN] {props.get('problematic_pattern')}",
        f"[FILE_PATTERN] {props.get('file_pattern') or ''}",
        f"[CLASS_PATTERN] {props.get('class_pattern') or ''}",
    ]
    
    # è§£å†³æ–¹æ¡ˆå±‚ï¼ˆç”¨äºéªŒè¯åŒ¹é…ï¼‰
    solution_parts = [
        f"[SOLUTION] {props.get('solution')}",
    ]
    
    return "\n".join(semantic_parts + code_pattern_parts + solution_parts)
2. å¤šå‘é‡ç´¢å¼•ç­–ç•¥
è€ƒè™‘ä¸ºä¸åŒçš„åŒ¹é…ç›®æ ‡åˆ›å»ºä¸åŒçš„å‘é‡ç´¢å¼•ï¼š

å†å²é—®é¢˜æ£€æµ‹ç´¢å¼•ï¼šä¾§é‡problematic_pattern + error_type
è¯¯æŠ¥å‡å°‘ç´¢å¼•ï¼šä¾§é‡error_description + solution + æŠ€æœ¯æ ˆä¿¡æ¯
